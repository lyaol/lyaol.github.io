<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  

  
  <title>liyoo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:type" content="website">
<meta property="og:title" content="liyoo">
<meta property="og:url" content="http://example.com/index.html">
<meta property="og:site_name" content="liyoo">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="liyoo">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="liyoo" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  
<link rel="stylesheet" href="/css/style.css">

<meta name="generator" content="Hexo 5.4.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">liyoo</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://example.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-c-ares C语言异步DNS解析库" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2021/11/01/c-ares%20C%E8%AF%AD%E8%A8%80%E5%BC%82%E6%AD%A5DNS%E8%A7%A3%E6%9E%90%E5%BA%93/" class="article-date">
  <time datetime="2021-11-01T06:54:54.486Z" itemprop="datePublished">2021-11-01</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="article-entry" itemprop="articleBody">
      
        <h4 id="c-ares-C语言异步DNS解析库"><a href="#c-ares-C语言异步DNS解析库" class="headerlink" title="c-ares C语言异步DNS解析库"></a>c-ares C语言异步DNS解析库</h4><p>​        在网络编程中，在需要进行直接访问域名的场景中，比如curl，根据数通知识可以知道，首先我们需要根据域名获取ip，而这个过程需要访问DNS服务器来完成的，也就是函数<code>gethostbyname</code>来完成。但是<code>gethostbyname</code>是同步的，当链路不通时会造成阻塞（无法设置超时时间)。所以异步DNS应运而生，官网地址:<a target="_blank" rel="noopener" href="https://c-ares.haxx.se/%E3%80%82">https://c-ares.haxx.se/。</a></p>
<hr>
<p>c-ares是一个C语言的异步DNS解析库，可以很方便的和使用者的事件循环统一起来，实现DNS的非阻塞异步解析，libcurl, libevent, gevent, nodejs都在使用。</p>
<p>下面摘自Stack Overflow的一个例子。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;time.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;netdb.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;arpa/inet.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;ares.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">//ares  处理完成，返回DNS解析的信息</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">dns_callback</span> <span class="params">(<span class="keyword">void</span>* arg, <span class="keyword">int</span> status, <span class="keyword">int</span> timeouts, struct hostent* host)</span>  </span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(status == ARES_SUCCESS)</span><br><span class="line">        <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; host-&gt;h_name &lt;&lt; <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;lookup failed: &quot;</span> &lt;&lt; status &lt;&lt; <span class="string">&#x27;\n&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">main_loop</span><span class="params">(ares_channel &amp;channel)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> nfds, count;</span><br><span class="line">    fd_set readers, writers;</span><br><span class="line">    timeval tv, *tvp;</span><br><span class="line">    <span class="keyword">while</span> (<span class="number">1</span>) &#123;</span><br><span class="line">        FD_ZERO(&amp;readers);</span><br><span class="line">        FD_ZERO(&amp;writers);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//获取ares channel使用的FD</span></span><br><span class="line">        nfds = ares_fds(channel, &amp;readers, &amp;writers);   </span><br><span class="line">        <span class="keyword">if</span> (nfds == <span class="number">0</span>)</span><br><span class="line">          <span class="keyword">break</span>;</span><br><span class="line">        tvp = ares_timeout(channel, <span class="literal">NULL</span>, &amp;tv);       </span><br><span class="line"></span><br><span class="line">        <span class="comment">//将ares的SOCKET FD 加入事件循环</span></span><br><span class="line">        count = select(nfds, &amp;readers, &amp;writers, <span class="literal">NULL</span>, tvp);   </span><br><span class="line"></span><br><span class="line">        <span class="comment">//有事件发生 交由ares 处理</span></span><br><span class="line">        ares_process(channel, &amp;readers, &amp;writers);  </span><br><span class="line">     &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> **argv)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">in_addr</span> <span class="title">ip</span>;</span></span><br><span class="line">    <span class="keyword">int</span> res;</span><br><span class="line">    <span class="keyword">if</span>(argc &lt; <span class="number">2</span> ) &#123;</span><br><span class="line">        <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;usage: &quot;</span> &lt;&lt; argv[<span class="number">0</span>] &lt;&lt; <span class="string">&quot; ip.address\n&quot;</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    inet_aton(argv[<span class="number">1</span>], &amp;ip);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//创建一个ares_channel </span></span><br><span class="line">    ares_channel channel;    </span><br><span class="line"></span><br><span class="line">    <span class="comment">//ares 对channel 进行初始化</span></span><br><span class="line">    <span class="keyword">if</span>((res = ares_init(&amp;channel)) != ARES_SUCCESS) &#123;    </span><br><span class="line">        <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;ares feiled: &quot;</span> &lt;&lt; res &lt;&lt; <span class="string">&#x27;\n&#x27;</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//传递给c-ares channal 和 回调</span></span><br><span class="line">    ares_gethostbyaddr(channel, &amp;ip, <span class="keyword">sizeof</span> ip, AF_INET, dns_callback, <span class="literal">NULL</span>); </span><br><span class="line"></span><br><span class="line">    <span class="comment">//主程序事件循环 </span></span><br><span class="line">    main_loop(channel);   </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<p>如果有需要可以采用c-ares实现一个自己的DNS异步解析的Server，做成独立的dns解析服务</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/11/01/c-ares%20C%E8%AF%AD%E8%A8%80%E5%BC%82%E6%AD%A5DNS%E8%A7%A3%E6%9E%90%E5%BA%93/" data-id="ckw7mskrx0000zsulh3ii18oh" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-电子合同模板生成步骤" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2021/11/01/%E7%94%B5%E5%AD%90%E5%90%88%E5%90%8C%E6%A8%A1%E6%9D%BF%E7%94%9F%E6%88%90%E6%AD%A5%E9%AA%A4/" class="article-date">
  <time datetime="2021-11-01T06:14:40.665Z" itemprop="datePublished">2021-11-01</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2021/11/01/%E7%94%B5%E5%AD%90%E5%90%88%E5%90%8C%E6%A8%A1%E6%9D%BF%E7%94%9F%E6%88%90%E6%AD%A5%E9%AA%A4/">电子合同模板生成</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>最近呢公司有个电子合同的需求，因为之前没有做过类似的需求，也没有什么文件处理的经验；刚开始的时候想的是直接按照业务方给的合同文件，直接手写合同模板。但是直接手写有个问题就是，合同的样式和格式非常的不好写，而且布局这些的作为服务端开发的我，并不擅长；而且项目周期非常紧张，时间上也不允许慢慢磨。因此尝试了很多种方法之后，采用了一种相对来说最为合适的方法。在制作合同模板的过程中遇到了非常非常多的问题，接下来就来记录下我的模板制作辛酸史吧！</p>
<h2 id="电子合同模板生成步骤："><a href="#电子合同模板生成步骤：" class="headerlink" title="电子合同模板生成步骤："></a>电子合同模板生成步骤：</h2><ol>
<li>将产品给到的合同源文件里面的需要插入的字段改成 {字段名}, 然后另存为 xxx.docx 文档；注意：是 .docx 文档，不然文档无法解析，这里修改源文件最好是用 Office 官方的 word 工具，用 wps 的话可能会出现 Windows 和 mac 不兼容的问题；不过如果用 Office 官方 word 的话，需要做额外的操作，来保证兼容 Windows，不太会。</li>
<li>在你的本地项目中创建三个文件夹：originalDocx, templateXml, completeDocx；其中 originalDocx 文件夹就是用来存储第一步生成的合同文档的，以此来作为制作模板的源文件。</li>
<li>执行下面的命令，解压缩 docx 文档为 xml 文件：</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">unzip -o &#x27;合同的源文件地址&#x27; -d &#x27;要解压到的地址&#x27;</span><br></pre></td></tr></table></figure>

<ol>
<li>找到 xml文件夹下的 -&gt; word -&gt; _rels -&gt; document.xml.rels 文件，设置成 html 格式化，比较方便修改；在这个文件中添加以下的代码，来添加 公司印章和甲方代理人的签名图片：</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;Relationship Id=&quot;&lt;%= signer_sign_image_rid %&gt;&quot; Type=&quot;http://schemas.openxmlformats.org/officeDocument/2006/relationships/image&quot;</span><br><span class="line">    Target=&quot;media/image&lt;%= signer_sign_image_rid %&gt;.png&quot; /&gt;</span><br><span class="line">&lt;Relationship Id=&quot;&lt;%= company_sign_image_rid %&gt;&quot; Type=&quot;http://schemas.openxmlformats.org/officeDocument/2006/relationships/image&quot;</span><br><span class="line">    Target=&quot;media/image&lt;%= company_sign_image_rid %&gt;.png&quot; /&gt;</span><br></pre></td></tr></table></figure>

<ol>
<li>找到 xml 文件夹下的 -&gt; word -&gt; document.xml 文件，将第一步中设置的所有字段 {字段名} 全部改成 &lt;%= 字段名 %&gt;</li>
<li>在第五步的基础上继续修改这个文件中的 &lt;w:t xml:space=”preserve”&gt; 文本内容 ，如果这个标签对里面有文本内容的话，将这个标签对改成 &lt;w:t&gt; 文本内容 , 这是因为在纯文本合同中只会提取 &lt;w:t&gt; 标签对里面的内容，其他的都不会被提取，如果不修改，会导致提取内容不全。</li>
<li>在第六步的基础上继续修改这个文件中的签名和印章部分的内容，这部分的内容每个合同都是统一的，所以只需要调整一个是对的，其他的直接拷贝替换就行，这部分的内容包括：甲方: xxx 乙方:xxxx（盖章）, 法定代理人: （签名），日期：xxx 日期：xxx，这一整块的内容直接替换成下面的这段代码：(注意：每个 &lt;w:p&gt; 标签对替换)</li>
</ol>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">w:p</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">w:pPr</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">w:spacing</span> <span class="attr">w:line</span>=<span class="string">&quot;360&quot;</span> <span class="attr">w:lineRule</span>=<span class="string">&quot;exact&quot;</span> /&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">w:ind</span> <span class="attr">w:firstLine</span>=<span class="string">&quot;0&quot;</span> <span class="attr">w:firstLineChars</span>=<span class="string">&quot;0&quot;</span> /&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">w:rPr</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">w:rFonts</span> <span class="attr">w:hint</span>=<span class="string">&quot;eastAsia&quot;</span> <span class="attr">w:ascii</span>=<span class="string">&quot;微软雅黑&quot;</span> <span class="attr">w:hAnsi</span>=<span class="string">&quot;微软雅黑&quot;</span> <span class="attr">w:eastAsia</span>=<span class="string">&quot;微软雅黑&quot;</span> <span class="attr">w:cs</span>=<span class="string">&quot;微软雅黑&quot;</span> /&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">w:szCs</span> <span class="attr">w:val</span>=<span class="string">&quot;21&quot;</span> /&gt;</span></span><br><span class="line">     <span class="tag">&lt;/<span class="name">w:rPr</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">w:pPr</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">w:r</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">w:rPr</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">w:rFonts</span> <span class="attr">w:hint</span>=<span class="string">&quot;eastAsia&quot;</span> <span class="attr">w:ascii</span>=<span class="string">&quot;微软雅黑&quot;</span> <span class="attr">w:hAnsi</span>=<span class="string">&quot;微软雅黑&quot;</span> <span class="attr">w:eastAsia</span>=<span class="string">&quot;微软雅黑&quot;</span> <span class="attr">w:cs</span>=<span class="string">&quot;微软雅黑&quot;</span> /&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">w:szCs</span> <span class="attr">w:val</span>=<span class="string">&quot;21&quot;</span> /&gt;</span></span><br><span class="line">     <span class="tag">&lt;/<span class="name">w:rPr</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">w:t</span>&gt;</span>甲方：&lt;%= student_name %&gt;                        乙方：xxx <span class="tag">&lt;/<span class="name">w:t</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">w:r</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">w:r</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">w:rPr</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">w:color</span> <span class="attr">w:val</span>=<span class="string">&quot;00FF00&quot;</span> /&gt;</span></span><br><span class="line">     <span class="tag">&lt;/<span class="name">w:rPr</span>&gt;</span></span><br><span class="line">     <span class="comment">&lt;!-- 公司印章图片 --&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">w:pict</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">v:shape</span> <span class="attr">id</span>=<span class="string">&quot;_xtpx_&lt;%= company_sign_image_rid %&gt;&quot;</span> <span class="attr">o:spt</span>=<span class="string">&quot;75&quot;</span> <span class="attr">type</span>=<span class="string">&quot;#_x0000_t75&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">style</span>=<span class="string">&quot;position:absolute;left:350px;top:-100px;z-index:100;height:&lt;%= company_sign_image_height %&gt;pt;width:&lt;%= company_sign_image_width %&gt;pt;&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">filled</span>=<span class="string">&quot;f&quot;</span> <span class="attr">o:preferrelative</span>=<span class="string">&quot;t&quot;</span> <span class="attr">stroked</span>=<span class="string">&quot;f&quot;</span> <span class="attr">coordsize</span>=<span class="string">&quot;21600, 21600&quot;</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">v:path</span>/&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">v:fill</span> <span class="attr">on</span>=<span class="string">&quot;f&quot;</span> <span class="attr">focussize</span>=<span class="string">&quot;0,0&quot;</span> /&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">v:stroke</span> <span class="attr">on</span>=<span class="string">&quot;f&quot;</span> <span class="attr">joinstyle</span>=<span class="string">&quot;miter&quot;</span> /&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">v:imagedata</span> <span class="attr">r:id</span>=<span class="string">&quot;&lt;%= company_sign_image_rid %&gt;&quot;</span> <span class="attr">o:title</span>=<span class="string">&quot;&quot;</span> /&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">o:lock</span> <span class="attr">v:ext</span>=<span class="string">&quot;edit&quot;</span> <span class="attr">aspectratio</span>=<span class="string">&quot;f&quot;</span> /&gt;</span></span><br><span class="line">         &lt;w:10:wrap type=&quot;none&quot; /&gt;</span><br><span class="line">         &lt;w:10:anchorlock /&gt;</span><br><span class="line">       <span class="tag">&lt;/<span class="name">v:shape</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;/<span class="name">w:pict</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">w:r</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">w:p</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">w:p</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">w:pPr</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">w:spacing</span> <span class="attr">w:line</span>=<span class="string">&quot;360&quot;</span> <span class="attr">w:lineRule</span>=<span class="string">&quot;exact&quot;</span> /&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">w:rPr</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">w:rFonts</span> <span class="attr">w:ascii</span>=<span class="string">&quot;微软雅黑&quot;</span> <span class="attr">w:hAnsi</span>=<span class="string">&quot;微软雅黑&quot;</span> <span class="attr">w:eastAsia</span>=<span class="string">&quot;微软雅黑&quot;</span> <span class="attr">w:cs</span>=<span class="string">&quot;微软雅黑&quot;</span> /&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">w:szCs</span> <span class="attr">w:val</span>=<span class="string">&quot;21&quot;</span> /&gt;</span></span><br><span class="line">     <span class="tag">&lt;/<span class="name">w:rPr</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">w:pPr</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">w:r</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">w:rPr</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">w:rFonts</span> <span class="attr">w:hint</span>=<span class="string">&quot;eastAsia&quot;</span> <span class="attr">w:ascii</span>=<span class="string">&quot;微软雅黑&quot;</span> <span class="attr">w:hAnsi</span>=<span class="string">&quot;微软雅黑&quot;</span> <span class="attr">w:eastAsia</span>=<span class="string">&quot;微软雅黑&quot;</span> <span class="attr">w:cs</span>=<span class="string">&quot;微软雅黑&quot;</span> /&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">w:szCs</span> <span class="attr">w:val</span>=<span class="string">&quot;21&quot;</span> /&gt;</span></span><br><span class="line">     <span class="tag">&lt;/<span class="name">w:rPr</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">w:t</span>&gt;</span>法定代理人：<span class="tag">&lt;/<span class="name">w:t</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">w:r</span>&gt;</span></span><br><span class="line">   <span class="comment">&lt;!-- 签约人手写签名图片 --&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">w:r</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">w:rPr</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">w:color</span> <span class="attr">w:val</span>=<span class="string">&quot;00FF00&quot;</span> /&gt;</span></span><br><span class="line">     <span class="tag">&lt;/<span class="name">w:rPr</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">w:pict</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">v:shape</span> <span class="attr">id</span>=<span class="string">&quot;_xtpx_&lt;%= signer_sign_image_rid %&gt;&quot;</span> <span class="attr">o:spt</span>=<span class="string">&quot;75&quot;</span> <span class="attr">type</span>=<span class="string">&quot;#_x0000_t75&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">style</span>=<span class="string">&quot;height:&lt;%= signer_sign_image_height %&gt;pt;width:&lt;%= signer_sign_image_width %&gt;pt;&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">filled</span>=<span class="string">&quot;f&quot;</span> <span class="attr">o:preferrelative</span>=<span class="string">&quot;t&quot;</span> <span class="attr">stroked</span>=<span class="string">&quot;f&quot;</span> <span class="attr">coordsize</span>=<span class="string">&quot;21600, 21600&quot;</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">v:path</span>/&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">v:fill</span> <span class="attr">on</span>=<span class="string">&quot;f&quot;</span> <span class="attr">focussize</span>=<span class="string">&quot;0,0&quot;</span> /&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">v:stroke</span> <span class="attr">on</span>=<span class="string">&quot;f&quot;</span> <span class="attr">joinstyle</span>=<span class="string">&quot;miter&quot;</span> /&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">v:imagedata</span> <span class="attr">r:id</span>=<span class="string">&quot;&lt;%= signer_sign_image_rid %&gt;&quot;</span> <span class="attr">o:title</span>=<span class="string">&quot;&quot;</span> /&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">o:lock</span> <span class="attr">v:ext</span>=<span class="string">&quot;edit&quot;</span> <span class="attr">aspectratio</span>=<span class="string">&quot;f&quot;</span> /&gt;</span></span><br><span class="line">         &lt;w:10:wrap type=&quot;none&quot; /&gt;</span><br><span class="line">         &lt;w:10:anchorlock /&gt;</span><br><span class="line">       <span class="tag">&lt;/<span class="name">v:shape</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;/<span class="name">w:pict</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">w:r</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">w:r</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">w:rPr</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">w:rFonts</span> <span class="attr">w:hint</span>=<span class="string">&quot;eastAsia&quot;</span> <span class="attr">w:ascii</span>=<span class="string">&quot;微软雅黑&quot;</span> <span class="attr">w:hAnsi</span>=<span class="string">&quot;微软雅黑&quot;</span> <span class="attr">w:eastAsia</span>=<span class="string">&quot;微软雅黑&quot;</span> <span class="attr">w:cs</span>=<span class="string">&quot;微软雅黑&quot;</span> /&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">w:szCs</span> <span class="attr">w:val</span>=<span class="string">&quot;21&quot;</span> /&gt;</span></span><br><span class="line">     <span class="tag">&lt;/<span class="name">w:rPr</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">w:t</span> <span class="attr">xml:space</span>=<span class="string">&quot;preserve&quot;</span>&gt;</span> <span class="tag">&lt;/<span class="name">w:t</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">w:r</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">w:bookmarkStart</span> <span class="attr">w:id</span>=<span class="string">&quot;5&quot;</span> <span class="attr">w:name</span>=<span class="string">&quot;_GoBack&quot;</span> /&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">w:bookmarkEnd</span> <span class="attr">w:id</span>=<span class="string">&quot;5&quot;</span> /&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">w:p</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">w:p</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">w:pPr</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">w:spacing</span> <span class="attr">w:line</span>=<span class="string">&quot;360&quot;</span> <span class="attr">w:lineRule</span>=<span class="string">&quot;exact&quot;</span> /&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">w:rPr</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">w:rFonts</span> <span class="attr">w:hint</span>=<span class="string">&quot;default&quot;</span> <span class="attr">w:ascii</span>=<span class="string">&quot;宋体&quot;</span> <span class="attr">w:hAnsi</span>=<span class="string">&quot;宋体&quot;</span> <span class="attr">w:eastAsia</span>=<span class="string">&quot;宋体&quot;</span> <span class="attr">w:cs</span>=<span class="string">&quot;Times New Roman&quot;</span> /&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">w:szCs</span> <span class="attr">w:val</span>=<span class="string">&quot;21&quot;</span> /&gt;</span></span><br><span class="line">     <span class="tag">&lt;/<span class="name">w:rPr</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">w:pPr</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">w:r</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">w:rPr</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">w:rFonts</span> <span class="attr">w:hint</span>=<span class="string">&quot;eastAsia&quot;</span> <span class="attr">w:ascii</span>=<span class="string">&quot;微软雅黑&quot;</span> <span class="attr">w:hAnsi</span>=<span class="string">&quot;微软雅黑&quot;</span> <span class="attr">w:eastAsia</span>=<span class="string">&quot;微软雅黑&quot;</span> <span class="attr">w:cs</span>=<span class="string">&quot;微软雅黑&quot;</span> /&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">w:szCs</span> <span class="attr">w:val</span>=<span class="string">&quot;21&quot;</span> /&gt;</span></span><br><span class="line">     <span class="tag">&lt;/<span class="name">w:rPr</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">w:t</span>&gt;</span>日期：&lt;%= sign_date %&gt;                               日期：&lt;%= sign_date %&gt;<span class="tag">&lt;/<span class="name">w:t</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">w:r</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">w:bookmarkEnd</span> <span class="attr">w:id</span>=<span class="string">&quot;0&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">w:p</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>这部分的内容有的合同可能有2个地方，有的合同只有一个。</p>
<ol>
<li>以上7个步骤全部完成之后，执行以下的命令，查看合同格式和内容：</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd 你的 xml 文件夹的地址</span><br><span class="line">zip ../&#123;name&#125;.docx -r .</span><br></pre></td></tr></table></figure>

<p>{name} 是你将要生成的空白 docx 模板的文件名，这个文件名的格式：全部大写。<br>注意：这个文件名到时候会添加到 mysql 数据表中，正式环境的数据表中也会添加，一定要注意文件名在不同地方的一致性。</p>
<ol>
<li>将第八步生成的 docx 文件拖到我们的 @xuetong/pdfmake 组件的 contractTemplates 目录下，所有的合同模板和图片都统一放在这个目录下。</li>
<li>ok，现在就可以测试了，在 fileData 方法中添加上你的合同字段 key:value ，在 main 函数中将传过去的模板名称换成第八步生成的模板名称即可。这里需要注意的是，除了那些 数组什么的字段可以用 object，其他的都用 string 格式，不然字段会插入失败。</li>
</ol>
<h2 id="模板细节的一些处理"><a href="#模板细节的一些处理" class="headerlink" title="模板细节的一些处理"></a>模板细节的一些处理</h2><h3 id="有些字段在特定条件下才会显示，其他的条件下隐藏："><a href="#有些字段在特定条件下才会显示，其他的条件下隐藏：" class="headerlink" title="有些字段在特定条件下才会显示，其他的条件下隐藏："></a>有些字段在特定条件下才会显示，其他的条件下隐藏：</h3><p>除了标签对代码，其他的自定义的可执行的代码必须用 &lt;% 可执行代码 %&gt; 符号抱起来，注意与字段插入符的区别，这里没有等号;</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">&lt;% if (order_discount &amp;&amp; Number(order_discount.slice(0, order_discount.length - 1)) &lt; 100) &#123; %&gt;</span><br><span class="line">  <span class="tag">&lt;<span class="name">w:p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">w:pPr</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">w:widowControl</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">w:spacing</span> <span class="attr">w:line</span>=<span class="string">&quot;360&quot;</span> <span class="attr">w:lineRule</span>=<span class="string">&quot;exact&quot;</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">w:ind</span> <span class="attr">w:left</span>=<span class="string">&quot;-2&quot;</span> <span class="attr">w:leftChars</span>=<span class="string">&quot;-1&quot;</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">w:jc</span> <span class="attr">w:val</span>=<span class="string">&quot;left&quot;</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">w:rPr</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">w:rFonts</span> <span class="attr">w:hint</span>=<span class="string">&quot;eastAsia&quot;</span> <span class="attr">w:ascii</span>=<span class="string">&quot;微软雅黑&quot;</span> <span class="attr">w:hAnsi</span>=<span class="string">&quot;微软雅黑&quot;</span> <span class="attr">w:eastAsia</span>=<span class="string">&quot;微软雅黑&quot;</span> <span class="attr">w:cs</span>=<span class="string">&quot;微软雅黑&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">w:b</span> <span class="attr">w:val</span>=<span class="string">&quot;0&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">w:bCs</span> <span class="attr">w:val</span>=<span class="string">&quot;0&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">w:kern</span> <span class="attr">w:val</span>=<span class="string">&quot;2&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">w:sz</span> <span class="attr">w:val</span>=<span class="string">&quot;21&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">w:szCs</span> <span class="attr">w:val</span>=<span class="string">&quot;21&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">w:highlight</span> <span class="attr">w:val</span>=<span class="string">&quot;none&quot;</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">w:rPr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">w:pPr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">w:r</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">w:rPr</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">w:rFonts</span> <span class="attr">w:hint</span>=<span class="string">&quot;eastAsia&quot;</span> <span class="attr">w:ascii</span>=<span class="string">&quot;微软雅黑&quot;</span> <span class="attr">w:hAnsi</span>=<span class="string">&quot;微软雅黑&quot;</span> <span class="attr">w:eastAsia</span>=<span class="string">&quot;微软雅黑&quot;</span> <span class="attr">w:cs</span>=<span class="string">&quot;微软雅黑&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">w:b</span> <span class="attr">w:val</span>=<span class="string">&quot;0&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">w:bCs</span> <span class="attr">w:val</span>=<span class="string">&quot;0&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">w:kern</span> <span class="attr">w:val</span>=<span class="string">&quot;2&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">w:sz</span> <span class="attr">w:val</span>=<span class="string">&quot;21&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">w:szCs</span> <span class="attr">w:val</span>=<span class="string">&quot;21&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">w:highlight</span> <span class="attr">w:val</span>=<span class="string">&quot;none&quot;</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">w:rPr</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">w:t</span>&gt;</span>折扣: &lt;%= order_discount %&gt;<span class="tag">&lt;/<span class="name">w:t</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">w:r</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">w:p</span>&gt;</span></span><br><span class="line">&lt;% &#125; %&gt;</span><br></pre></td></tr></table></figure>

<h3 id="for-循环插入列表"><a href="#for-循环插入列表" class="headerlink" title="for 循环插入列表"></a>for 循环插入列表</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">&lt;% _.forEach(subject_name_list, (item, index) =&gt; &#123; %&gt;</span><br><span class="line">  <span class="tag">&lt;<span class="name">w:p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">w:pPr</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">w:pStyle</span> <span class="attr">w:val</span>=<span class="string">&quot;3&quot;</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">w:ind</span> <span class="attr">w:right</span>=<span class="string">&quot;108&quot;</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">w:rPr</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">w:rFonts</span> <span class="attr">w:hint</span>=<span class="string">&quot;eastAsia&quot;</span> <span class="attr">w:ascii</span>=<span class="string">&quot;微软雅黑&quot;</span> <span class="attr">w:hAnsi</span>=<span class="string">&quot;微软雅黑&quot;</span> <span class="attr">w:eastAsia</span>=<span class="string">&quot;微软雅黑&quot;</span> <span class="attr">w:cs</span>=<span class="string">&quot;微软雅黑&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">w:b</span> <span class="attr">w:val</span>=<span class="string">&quot;0&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">w:bCs</span> <span class="attr">w:val</span>=<span class="string">&quot;0&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">w:kern</span> <span class="attr">w:val</span>=<span class="string">&quot;2&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">w:sz</span> <span class="attr">w:val</span>=<span class="string">&quot;21&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">w:szCs</span> <span class="attr">w:val</span>=<span class="string">&quot;21&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">w:highlight</span> <span class="attr">w:val</span>=<span class="string">&quot;none&quot;</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">w:rPr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">w:pPr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">w:r</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">w:rPr</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">w:rFonts</span> <span class="attr">w:hint</span>=<span class="string">&quot;default&quot;</span> <span class="attr">w:ascii</span>=<span class="string">&quot;微软雅黑&quot;</span> <span class="attr">w:hAnsi</span>=<span class="string">&quot;微软雅黑&quot;</span> <span class="attr">w:eastAsia</span>=<span class="string">&quot;微软雅黑&quot;</span> <span class="attr">w:cs</span>=<span class="string">&quot;微软雅黑&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">w:kern</span> <span class="attr">w:val</span>=<span class="string">&quot;2&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">w:sz</span> <span class="attr">w:val</span>=<span class="string">&quot;21&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">w:szCs</span> <span class="attr">w:val</span>=<span class="string">&quot;21&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">w:highlight</span> <span class="attr">w:val</span>=<span class="string">&quot;none&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">w:lang</span> <span class="attr">w:eastAsia</span>=<span class="string">&quot;zh-CN&quot;</span> <span class="attr">w:bidi</span>=<span class="string">&quot;ar-SA&quot;</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">w:rPr</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">w:t</span>&gt;</span>商品&lt;%= index + 1 %&gt;：&lt;%= item.product_name %&gt;<span class="tag">&lt;/<span class="name">w:t</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">w:r</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">w:p</span>&gt;</span></span><br><span class="line">&lt;% &#125;); %&gt;</span><br></pre></td></tr></table></figure>

<h2 id="遇到的一些问题"><a href="#遇到的一些问题" class="headerlink" title="遇到的一些问题"></a>遇到的一些问题</h2><h3 id="本地和测试环境签名都能下载成功，并且图片可打开，但是在正式环境下载的图片是破损不可打开的。"><a href="#本地和测试环境签名都能下载成功，并且图片可打开，但是在正式环境下载的图片是破损不可打开的。" class="headerlink" title="本地和测试环境签名都能下载成功，并且图片可打开，但是在正式环境下载的图片是破损不可打开的。"></a>本地和测试环境签名都能下载成功，并且图片可打开，但是在正式环境下载的图片是破损不可打开的。</h3><ol>
<li>因为在我们的电子合同中使用到了签名和盖章，这些都是需要从指定网站先下载图片到临时文件夹。然而这个问题排查了半天发现，是客户端传过来的签名连接就是错误的，他把测试环境的地址直接写死在代码里了，导致生产的地址依然是测试地址，因此图片下载失败。所以不管是排查什么 bug，都要记住：<ul>
<li>查看数据源（数据库保存的数据）是否正确</li>
<li>查看客户端传过来的数据是否正确</li>
<li>查看数据格式是否正确</li>
<li>最后排查代码是否有bug,如果一开始就漫无目的拼命的检查的话，可能会出现浪费时间且没有结果的情况。</li>
</ul>
</li>
<li>手写签名下载失败： Error: getaddrinfo ENOTFOUND s-test.yxuetong.com，阿里内网服务禁止访问外网域名<br><a target="_blank" rel="noopener" href="https://blog.csdn.net/qappleh/article/details/99990277">服务器域名访问失败</a></li>
</ol>
<blockquote>
<p>注意📢 ，还要一点非常重要的一点是，格式，样式的问题，都应该是在源文件的拷贝复件，在 office 工作中修改，然后转成模板。只有确定源文件是没有问题的，转出来的文件才能确定是没有文件的。</p>
</blockquote>
<h3 id="本地调试的时候可以使用-docker-开启一个-pdf-服务，因为在-docx-转成-pdf-的过程是在-thecodingmachine-gotenberg-6-服务的基础上完成。"><a href="#本地调试的时候可以使用-docker-开启一个-pdf-服务，因为在-docx-转成-pdf-的过程是在-thecodingmachine-gotenberg-6-服务的基础上完成。" class="headerlink" title="本地调试的时候可以使用 docker 开启一个 pdf 服务，因为在 docx 转成 pdf 的过程是在 thecodingmachine/gotenberg:6 服务的基础上完成。"></a>本地调试的时候可以使用 docker 开启一个 pdf 服务，因为在 docx 转成 pdf 的过程是在 thecodingmachine/gotenberg:6 服务的基础上完成。</h3><p>docker 的安装</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">sudo yum remove docker \</span><br><span class="line">                  docker-client \</span><br><span class="line">                  docker-client-latest \</span><br><span class="line">                  docker-common \</span><br><span class="line">                  docker-latest \</span><br><span class="line">                  docker-latest-logrotate \</span><br><span class="line">                  docker-logrotate \</span><br><span class="line">                  docker-selinux \</span><br><span class="line">                  docker-engine-selinux \</span><br><span class="line">                  docker-engine</span><br><span class="line"></span><br><span class="line">sudo yum install -y yum-utils device-mapper-persistent-data lvm2</span><br><span class="line"></span><br><span class="line">sudo yum-config-manager --add-repo http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo</span><br><span class="line"></span><br><span class="line">sudo yum makecache fast</span><br><span class="line"></span><br><span class="line">sudo yum -y install docker-ce</span><br><span class="line"></span><br><span class="line">sudo systemctl start docker</span><br></pre></td></tr></table></figure>

<p>开启 pdf 服务</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">docker run --rm -p 3000:3000 thecodingmachine/gotenberg:6</span><br><span class="line"></span><br><span class="line">验证服务是否开启成功</span><br><span class="line">--url http://localhost:3000/convert/office \</span><br><span class="line">--header &#x27;Content-Type: multipart/form-data&#x27; \</span><br><span class="line">--form files=@&#123;可打开的docx文件地址&#125; \</span><br><span class="line">-o result.pdf</span><br></pre></td></tr></table></figure>

<p>gotenberg:6 在 node.js 服务中的应用代码部分：<a target="_blank" rel="noopener" href="https://github.com/yumauri/gotenberg-js-client">js 代码部分</a></p>
<h3 id="dirname-和-process-cwd-的区别"><a href="#dirname-和-process-cwd-的区别" class="headerlink" title="__dirname 和 process.cwd() 的区别"></a>__dirname 和 process.cwd() 的区别</h3><p>在写电子合同组件的时候我刚开始使用的 process.cwd()</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&quot;path&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&quot;__dirname: &quot;</span>, __dirname); <span class="comment">// 获得当前文件所在目录的完整目录名。【不包含文件名本身的绝对路径】</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&quot;__filename: &quot;</span>, __filename); <span class="comment">// 获取当前模块文件的带有完整绝对路径的文件名；【包含文件名本身的绝对路径】</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&quot;module.filename: &quot;</span>, <span class="built_in">module</span>.filename); <span class="comment">// 等同于 __filename</span></span><br><span class="line">process.chdir(path.join(process.cwd(), <span class="string">&quot;../&quot;</span>, <span class="string">&quot;zhoulx_notes&quot;</span>)) <span class="comment">// 改变工作目录：暂时还不知道怎么用</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&quot;process.chdir: &quot;</span>, process.cwd());</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&quot;process.cwd()&quot;</span>, process.cwd()); <span class="comment">// 返回运行当前脚本的工作目录的路径</span></span><br></pre></td></tr></table></figure>

<h3 id="多进程与文件删除"><a href="#多进程与文件删除" class="headerlink" title="多进程与文件删除"></a>多进程与文件删除</h3><p>服务器，docker 容器，进程，child_process，子父进程共享服务器，子父进程共享信息，</p>
<p>child_process 开启的子进程 与 pm2 开启的进程 有什么区别呢？跟服务器进程有什么区别呢？与docker 容器开启的进程有什么区别呢？</p>
<ul>
<li>exec - child_process.exec 使用子进程执行命令，缓存子进程的输出，并将子进程的输出以回调函数的形式返回；</li>
<li>spawn - child_process.spawn 使用指定的命令行参数创建新进程</li>
<li>fork - child_process.fork 是 spawn 的特殊形式，用于在子进程中运行的模块，如 fork(‘./son.js) 相当于 spawn(‘node), [‘./son.js]).与 spawn 方法不同的是，fork 会在父进程与子进程之间，建立一个通信管道，用于进程之间的通信。</li>
<li>非空文件删除：fd.rmdir 只能删除空的文件(如果用递归删除的话可能会出现删除不干净导致 directory is not empty 的错误)，rimraf 可以删除任意文件路径</li>
</ul>
<p>文件/文件夹的（mkdirp,rimraf）工具类的封装<br><a target="_blank" rel="noopener" href="https://github.com/bruce/node-temp">原文地址</a></p>
<h3 id="lodash-template-模板函数的使用"><a href="#lodash-template-模板函数的使用" class="headerlink" title="lodash.template() 模板函数的使用"></a>lodash.template() 模板函数的使用</h3><p>_.template(templateString, [settings]);<br>将 JavaScript 模板编译为可以用于页面呈现的函数，对于通过 JSON 数据源生成复杂的 HTML 并呈现出来的操作非常有用。</p>
<ul>
<li>&lt;%= … %&gt; 插入变量名称</li>
<li>&lt;% … %&gt; 执行任意的 JavaScript 代码。</li>
<li>&lt;%- … %&gt; 插入一个值，并让它进行 HTML 的转义</li>
</ul>
<p>赋值：传递一个含有与模板对应属性的 data 对象。参数 settings 是一个哈希表包含任何可以覆盖的设置</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> _ = <span class="built_in">require</span>(<span class="string">&quot;lodash&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> compiled = _.template(<span class="string">&quot;hello: &lt;%= name %&gt;&quot;</span>);</span><br><span class="line"><span class="built_in">console</span>.log(compiled(&#123;<span class="attr">name</span>: <span class="string">&quot;moe&quot;</span>&#125;));</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> template = _.template(<span class="string">&quot;&lt;b&gt;&lt;%= value %&gt;&lt;/b&gt;&quot;</span>);</span><br><span class="line"><span class="built_in">console</span>.log(template(&#123;<span class="attr">value</span>: <span class="string">&#x27;&lt;script&gt;&#x27;</span>&#125;));</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> t1 = _.template(<span class="string">&quot;&lt;% print(&#x27;Hello &#x27; + epithet); %&gt;&quot;</span>);</span><br><span class="line"><span class="built_in">console</span>.log(t1(&#123;<span class="attr">epithet</span>: <span class="string">&quot;stooge&quot;</span>&#125;));</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(_.template(<span class="string">&quot;Using &#x27;with&#x27;: &lt;%= data.answer %&gt;&quot;</span>, &#123;<span class="attr">variable</span>: <span class="string">&#x27;data&#x27;</span>&#125;)(&#123;<span class="attr">answer</span>: <span class="string">&#x27;no&#x27;</span>&#125;));</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> t2 = _.template(<span class="string">&quot;Hello &#123;&#123;name&#125;&#125;!&quot;</span>);</span><br><span class="line"><span class="built_in">console</span>.log(t2(&#123;<span class="attr">name</span>: <span class="string">&quot;Mustache&quot;</span>&#125;));</span><br></pre></td></tr></table></figure>

<p>templateString 是一个模板字符串，template 函数负责解析这个模板字符串，所以这个模板字符串需要按规矩写，这个字符串本质是 js、标识符、html代码三者糅合的字符串。</p>
<h3 id="lodash-的使用"><a href="#lodash-的使用" class="headerlink" title="lodash 的使用"></a>lodash 的使用</h3><p>lodash 通过降低 array、number、objects、string 等等的使用难度从而让 JavaScript 变得简单。lodash 的模块化方法非常适用于：</p>
<ul>
<li>遍历 array、object 和 string</li>
<li>对值进行操作和检测</li>
<li>创建符合功能的函数</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://github.com/smartprocure/futil-js">参考文章 futil-js</a> 补足 lodash 的实用工具；</p>
<p><a target="_blank" rel="noopener" href="https://juejin.cn/post/6922710332813082638">参考文章 lodash使用</a>;</p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/Strawberry_595/article/details/88984468">参考连接</a>;</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/11/01/%E7%94%B5%E5%AD%90%E5%90%88%E5%90%8C%E6%A8%A1%E6%9D%BF%E7%94%9F%E6%88%90%E6%AD%A5%E9%AA%A4/" data-id="ckvgaceuo0001n0ul99x5867a" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-hello-world" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2021/11/01/hello-world/" class="article-date">
  <time datetime="2021-11-01T05:35:29.708Z" itemprop="datePublished">2021-11-01</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2021/11/01/hello-world/">Hello World</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>Welcome to <a target="_blank" rel="noopener" href="https://hexo.io/">Hexo</a>! This is your very first post. Check <a target="_blank" rel="noopener" href="https://hexo.io/docs/">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a target="_blank" rel="noopener" href="https://hexo.io/docs/troubleshooting.html">troubleshooting</a> or you can ask me on <a target="_blank" rel="noopener" href="https://github.com/hexojs/hexo/issues">GitHub</a>.</p>
<h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new <span class="string">&quot;My New Post&quot;</span></span><br></pre></td></tr></table></figure>

<p>More info: <a target="_blank" rel="noopener" href="https://hexo.io/docs/writing.html">Writing</a></p>
<h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure>

<p>More info: <a target="_blank" rel="noopener" href="https://hexo.io/docs/server.html">Server</a></p>
<h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure>

<p>More info: <a target="_blank" rel="noopener" href="https://hexo.io/docs/generating.html">Generating</a></p>
<h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure>

<p>More info: <a target="_blank" rel="noopener" href="https://hexo.io/docs/one-command-deployment.html">Deployment</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/11/01/hello-world/" data-id="ckvgaceu90000n0ulfi8t4cqd" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  


</section>
        
          <aside id="sidebar">
  
    

  
    

  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/11/">November 2021</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2021/11/01/c-ares%20C%E8%AF%AD%E8%A8%80%E5%BC%82%E6%AD%A5DNS%E8%A7%A3%E6%9E%90%E5%BA%93/">(no title)</a>
          </li>
        
          <li>
            <a href="/2021/11/01/%E7%94%B5%E5%AD%90%E5%90%88%E5%90%8C%E6%A8%A1%E6%9D%BF%E7%94%9F%E6%88%90%E6%AD%A5%E9%AA%A4/">电子合同模板生成</a>
          </li>
        
          <li>
            <a href="/2021/11/01/hello-world/">Hello World</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2021 liyoo<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  
<link rel="stylesheet" href="/fancybox/jquery.fancybox.css">

  
<script src="/fancybox/jquery.fancybox.pack.js"></script>




<script src="/js/script.js"></script>




  </div>
</body>
</html>